FROM ghcr.io/valaseklukas-svg/farsite:rocky8 as farsite
FROM ghcr.io/iisas/domino-base-piece:latest

RUN pip install --no-cache-dir domino-py-iisas

COPY --from=farsite /usr/local/bin/TestFARSITE /usr/local/bin/TestFARSITE
COPY --from=farsite /usr/local/bin/run_farsite.sh /usr/local/bin/run_farsite.sh
RUN chmod +x /usr/local/bin/TestFARSITE /usr/local/bin/run_farsite.sh

# --- embedded smoke-test inputs (no shared storage needed) ---
RUN mkdir -p /work
COPY assets/test/ /work/
RUN ls -la /work

COPY config.toml domino/pieces_repository/
COPY pieces domino/pieces_repository/pieces
COPY .domino domino/pieces_repository/.domino
